{% extends "../base_site.html" %}

{#{% block extrastyle %}{{ block.super }}<link rel="stylesheet" type="text/css" href="{% static "admin/css/dashboard.css" %}" />{% endblock %}#}

{% block content %}

    <div class="col-xs-12 col-md-8">
        <div class="col-xs-12 col-sm-12 mb-4">
            <h4>{{ content }}</h4>
        </div>
        <div class="col-xs-12 col-sm-12 mb-4">
            {% for symptom in symptoms %}
                <button class="btn btn-info mr-2 mb-2 ans-btn"  id="{{ symptom.id }}">{{ symptom.symptom_name }}</button>
            {% endfor %}
        </div>
        <p>or more?</p>
        <div class="input-group col-xs-10 col-sm-10 mb-4">
            <input type="text" class="form-control" id="input-disease">
            <div class="input-group-append">
                <button class="btn btn-outline-secondary" type="button" onclick="add_symptom()">Add</button>
            </div>
        </div>

        <div class="col-xs-12 col-sm-12 mb-4">
            <p>You might want to search the term below?</p>
            <p class="" id="api-response">
                {{ response }}
            </p>
        </div>
    </div>
    <div class="col-xs-12 col-md-4 pl-1 pr-1">

        <div class="pl-2 mb-1" style="font-size: small;border-left:solid .25rem;border-left-color: #f0ad4e;">
            <span class="badge badge-secondary">Help</span>
            The meaning of
            <b>{{ disease.name }}</b> is:
            <p id="disease-def">

            </p>

        </div>
        <ul class="nav selected-ans">

        </ul>
        <button class="btn btn-dark" type="button" onclick="next_question()">Next</button>
    </div>
    {% block object-tools %}{% endblock %}


{% endblock %}

{% block extrascript %}
<script>
{# TODO: SET COOKIE WHEN FIRST LOAD #}
function get_def_umls() {
    var tgt = session['tgt'];
    var st = "loop";
    if(tgt){
        console.log("from session:");
        get_st_from_UMLS(tgt);
        st = serviceTicket;
    } else {
        console.log("from Auth:");
        st = get_api_from_UMLS();
    }
    if(status != 200){
        return
    }
    url = "https://uts-ws.nlm.nih.gov/rest/content/current/CUI/{{ disease.content_unique_id }}/definitions";
    $.getJSON(url, {"ticket":st},function (res) {
        var result = res.result[0];
        var def = result.value;
        $("#disease-def").html(def);
    }).fail(function () {
        $("#disease-def").html("Sorry, there is no defination about this disease.");
    });
}
function add_symptom(){
    var text = $("#input-disease").val();
    $(".selected-ans").append("<button class='btn btn-info mr-2 mb-2 ans-btn' >"+ text +"</button>");
}

get_def_umls();
$(function () {
    $(".ans-btn").click(function () {

        $(".selected-ans").append($(this));
    })
})
</script>
{% endblock %}